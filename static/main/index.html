<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vertex ‚Äî Tools</title>
    <style>
        :root {
            --apple-bg: #f5f5f7;
            --apple-card: #ffffff;
            --apple-text: #1d1d1f;
            --apple-secondary: #6e6e73;
            --apple-blue: #0071e3;
            --apple-border: #e5e5ea;
            --shadow: 0 12px 30px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            background: var(--apple-bg);
            color: var(--apple-text);
            min-height: 100vh;
            overflow: hidden;
        }

        .page {
            display: grid;
            grid-template-columns: 280px 1fr 260px;
            gap: 24px;
            padding: 28px;
            min-height: 100vh;
        }

        .sidebar {
            background: var(--apple-card);
            border-radius: 24px;
            padding: 22px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: calc(100vh - 56px);
            overflow-y: auto;
            
        }

        .sidebar h2 {
            margin: 0 0 8px;
            font-size: 16px;
            color: var(--apple-secondary);
            font-weight: 600;
            letter-spacing: 0.2px;
        }

        .tool-card {
            background: #f7f7f9;
            border: 1px solid var(--apple-border);
            border-radius: 18px;
            padding: 14px 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 120ms ease, box-shadow 120ms ease;
            cursor: pointer;
        }

        .tool-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.08);
            background: #ffffff;
        }

        .tool-emoji {
            font-size: 18px;
        }

        .center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-state {
            background: var(--apple-card);
            border-radius: 28px;
            padding: 48px 56px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--apple-border);
            max-width: 520px;
            width: 100%;
        }

        .empty-state h1 {
            margin: 0 0 10px;
            font-size: 22px;
            font-weight: 700;
        }

        .empty-state p {
            margin: 0;
            color: var(--apple-secondary);
            font-size: 14px;
        }

        .tool-panel {
            background: var(--apple-card);
            border-radius: 28px;
            padding: 28px;
            box-shadow: var(--shadow);
            border: 1px solid var(--apple-border);
            max-width: 900px;
            width: 100%;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 18px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 700;
        }

        .panel-subtitle {
            font-size: 12px;
            color: var(--apple-secondary);
        }

        .primary-btn {
            background: var(--apple-blue);
            color: #fff;
            border: none;
            border-radius: 14px;
            padding: 10px 16px;
            cursor: pointer;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
            margin-bottom: 18px;
        }

        .field label {
            display: block;
            font-size: 12px;
            color: var(--apple-secondary);
            margin-bottom: 6px;
        }

        .field input,
        .field select,
        .field textarea {
            width: 100%;
            border: 1px solid var(--apple-border);
            border-radius: 12px;
            padding: 10px 12px;
            background: #fafafa;
            font-size: 13px;
        }

        .field textarea {
            min-height: 90px;
            resize: vertical;
        }

        .layers {
            background: #f7f7f9;
            border: 1px solid var(--apple-border);
            border-radius: 18px;
            padding: 12px;
            margin-bottom: 18px;
        }

        .layers-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .layer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 0.7fr auto;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }

        .ghost-btn {
            background: transparent;
            border: 1px solid var(--apple-border);
            border-radius: 10px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
        }

        .remove-btn {
            border: none;
            background: #ffe8e8;
            color: #b42318;
            border-radius: 10px;
            padding: 6px 8px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        .panel-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }
        
        .doc-card {
            background: #f7f7f9;
            border: 1px solid var(--apple-border);
            border-radius: 16px;
            padding: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        .doc-name {
            font-size: 13px;
            color: var(--apple-text);
            word-break: break-all;
        }
        .doc-link {
            font-size: 12px;
            color: var(--apple-blue);
            text-decoration: none;
        }

.result-card {
            background: #f7f7f9;
            border: 1px solid var(--apple-border);
            border-radius: 16px;
            padding: 14px;
        }

        .result-card .label {
            font-size: 12px;
            color: var(--apple-secondary);
        }

        .result-card .value {
            font-size: 16px;
            font-weight: 700;
            margin-top: 6px;
        }

        .right {
            display: flex;
            justify-content: flex-end;

            gap: 10px;
        }

        .user-chip {
            background: var(--apple-card);
            border-radius: 20px;
            padding: 10px 12px;
            text-decoration: none; /* —É–±–∏—Ä–∞–µ–º –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ */
    color: inherit; /* —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ —Å—Ç–∞–ª —Å–∏–Ω–∏–º */
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
            border: 1px solid var(--apple-border);
            height: fit-content;
        }

        .user-chip img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-text {
            display: flex;
            flex-direction: column;
            line-height: 1.1;
        }

        .user-text .login {
            font-size: 13px;
            font-weight: 600;
        }

        .user-text .hint {
            font-size: 11px;
            color: var(--apple-secondary);
        }

        
        .divider {
            border: none;
            border-top: 1px solid var(--apple-border);
            margin: 10px 0 6px;
        }


        .premium-card {
            margin-top: 14px;
            background: linear-gradient(135deg, #111827, #1f2937);
            color: #fff;
            border-radius: 18px;
            padding: 16px;
            box-shadow: var(--shadow);
        }
        .premium-card h3 {
            margin: 0 0 6px;
            font-size: 14px;
        }
        .premium-card p {
            margin: 0 0 10px;
            font-size: 12px;
            color: #e5e7eb;
        }
        .premium-card .price {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .right-adjusted {
    margin-top: 10px;
}

        .premium-btn {
            background: #10b981;
            border: none;
            color: #fff;
            border-radius: 12px;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: 600;
        }
        .tool-card.locked {
            opacity: 0.6;
        }
        .lock-badge {
            margin-left: auto;
            font-size: 12px;
            color: #9ca3af;
        }


        .premium-pill {
            margin-top: 12px;
            border: none;
            border-radius: 999px;
            padding: 8px 14px;
            font-size: 12px;
            font-weight: 700;
            color: #3a2c00;
            background: linear-gradient(135deg, #f6d365, #fda085);
            box-shadow: 0 6px 16px rgba(245, 158, 11, 0.25);
            cursor: pointer;
            height: fit-content;
        }
        .premium-pill.active {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #064e3b;
            cursor: default;
        }

@media (max-width: 980px) {
            .page {
                grid-template-columns: 1fr;
            }
            .right {
                justify-content: flex-start;
            }
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 640px) {
            .panel-grid {
                grid-template-columns: 1fr;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .layer-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page">
        <aside class="sidebar">
            <h2>Tools</h2>
            <div class="tool-card" data-target="piles">
                <span class="tool-emoji">üìä</span>
                <span>–†–∞—Å—á—ë—Ç —Å–≤–∞–π–Ω–æ–≥–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞</span>
            </div>
            <div class="tool-card" data-target="beam">
                <span class="tool-emoji">üèóÔ∏è</span>
                <span>–ü–æ–¥–±–æ—Ä –±–∞–ª–∫–∏ –ø–æ –º–æ–º–µ–Ω—Ç—É</span>
            </div>
            <div class="tool-card" data-target="loads">
                <span class="tool-emoji">‚öñÔ∏è</span>
                <span>–°–±–æ—Ä –Ω–∞–≥—Ä—É–∑–æ–∫</span>
            </div>
            <div class="tool-card" data-target="anchors">
                <span class="tool-emoji">üß∑</span>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–∫–µ—Ä–æ–≤</span>
            </div>
            <div class="tool-card" data-target="deflection">
                <span class="tool-emoji">üìâ</span>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥–∏–±–∞</span>
            </div>
            <div class="tool-card" data-target="joints">
                <span class="tool-emoji">üî©</span>
                <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–∞—Ä–Ω—ã—Ö —à–≤–æ–≤</span>
            </div>
            <div class="tool-card" data-target="report">
                <span class="tool-emoji">üìù</span>
                <span>PDF –æ—Ç—á—ë—Ç</span>
            </div>
            <div class="tool-card" data-target="column">
                <span class="tool-emoji">üè¢</span>
                <span>–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫–æ–ª–æ–Ω–Ω—ã</span>
            </div>
            <div class="tool-card" data-target="slab">
                <span class="tool-emoji">üß±</span>
                <span>–ü–æ–¥–±–æ—Ä –∞—Ä–º–∞—Ç—É—Ä—ã –ø–ª–∏—Ç—ã</span>
            </div>
            <hr class="divider">
            <div class="tool-card" data-target="piles-sp" data-premium="true">
                <span class="tool-emoji">üìä</span>
                <span>–°–≤–∞–π–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç (–°–ü)</span><span class="lock-badge">üîí</span>
            </div>
            <div class="tool-card" data-target="beam-sp" data-premium="true">
                <span class="tool-emoji">üèóÔ∏è</span>
                <span>–ë–∞–ª–∫–∞ (–°–ü 63)</span><span class="lock-badge">üîí</span>
            </div>
            <div class="tool-card" data-target="loads-sp" data-premium="true">
                <span class="tool-emoji">‚öñÔ∏è</span>
                <span>–ù–∞–≥—Ä—É–∑–∫–∏ (–°–ü)</span><span class="lock-badge">üîí</span>
            </div>
            <div class="tool-card" data-target="anchors-sp" data-premium="true">
                <span class="tool-emoji">üß∑</span>
                <span>–ê–Ω–∫–µ—Ä—ã (–°–ü)</span><span class="lock-badge">üîí</span>
            </div>
            <div class="tool-card" data-target="deflection-sp" data-premium="true">
                <span class="tool-emoji">üìâ</span>
                <span>–ü—Ä–æ–≥–∏–± (–°–ü 63)</span><span class="lock-badge">üîí</span>
            </div>
            <div class="tool-card" data-target="joints-sp" data-premium="true">
                <span class="tool-emoji">üî©</span>
                <span>–°–≤–∞—Ä–Ω—ã–µ —à–≤—ã (–°–ü)</span><span class="lock-badge">üîí</span>
            </div>
            <div class="tool-card" data-target="column-sp" data-premium="true">
                <span class="tool-emoji">üè¢</span>
                <span>–ö–æ–ª–æ–Ω–Ω–∞ (–°–ü 63)</span><span class="lock-badge">üîí</span>
            </div>
            <div class="tool-card" data-target="slab-sp" data-premium="true">
                <span class="tool-emoji">üß±</span>
                <span>–ü–ª–∏—Ç–∞ (–°–ü 63)</span><span class="lock-badge">üîí</span>
            </div>
            <div class="tool-card" data-target="report-sp" data-premium="true">
                <span class="tool-emoji">üìù</span>
                <span>–û—Ç—á—ë—Ç (–°–ü)</span><span class="lock-badge">üîí</span>
            </div>
            <hr class="divider">
            <div class="tool-card" data-target="info">
                <span class="tool-emoji">üìÅ</span>
                <span>–î–æ–∫—É–º–µ–Ω—Ç—ã (docs)</span>
            </div>
        </aside>

        <main class="center">
            <div class="empty-state" id="emptyState">
                <h1>Open any tool to get started</h1>
                <p>Select a tool from the left to begin.</p>
            </div>

            <div class="tool-panel" id="panel-piles" >
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Pile Foundation Calculation</div>
                        <div class="panel-subtitle">Enter input data and calculate</div>
                    </div>
                    <button class="primary-btn" id="runPiles">Calculate</button>
                </div>

                <div class="form-grid">
                    <div class="field">
                        <label for="method">Method</label>
                        <select id="method">
                            <option value="SP24">SP 24.13330</option>
                            <option value="SP22">SP 22.13330</option>
                            <option value="EC7">EN 1997-1 (EC7)</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="pileType">Pile type</label>
                        <select id="pileType">
                            <option value="square">Square</option>
                            <option value="round">Round</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="sideM">Side (m)</label>
                        <input id="sideM" type="number" step="0.01" value="0.4" />
                    </div>
                    <div class="field">
                        <label for="diameterM">Diameter (m)</label>
                        <input id="diameterM" type="number" step="0.01" value="0.4" />
                    </div>
                    <div class="field">
                        <label for="lengthM">Length (m)</label>
                        <input id="lengthM" type="number" step="0.1" value="12" />
                    </div>
                    <div class="field">
                        <label for="toeDepthM">Toe depth (m)</label>
                        <input id="toeDepthM" type="number" step="0.1" value="12" />
                    </div>
                    <div class="field">
                        <label for="baseQb">Base resistance q<sub>b</sub> (kPa)</label>
                        <input id="baseQb" type="number" step="1" value="3000" />
                    </div>
                    <div class="field">
                        <label for="loadG">Permanent load G (kN)</label>
                        <input id="loadG" type="number" step="1" value="15000" />
                    </div>
                    <div class="field">
                        <label for="loadQLong">Long-term load Q (kN)</label>
                        <input id="loadQLong" type="number" step="1" value="4000" />
                    </div>
                    <div class="field">
                        <label for="loadQShort">Short-term load Q (kN)</label>
                        <input id="loadQShort" type="number" step="1" value="2000" />
                    </div>
                </div>

                <div class="layers">
                    <div class="layers-header">
                        <div class="panel-title">Soil layers</div>
                        <button class="ghost-btn" id="addLayer">Add layer</button>
                    </div>
                    <div id="layersGrid"></div>
                </div>

                <div class="panel-grid">
                    <div class="result-card">
                        <div class="label">Average load per pile</div>
                        <div class="value" id="avgLoad">‚Äî</div>
                    </div>
                    <div class="result-card">
                        <div class="label">Pile count</div>
                        <div class="value" id="pileCount">‚Äî</div>
                    </div>
                    <div class="result-card">
                        <div class="label">Design resistance</div>
                        <div class="value" id="designRes">‚Äî</div>
                    </div>
                    <div class="result-card">
                        <div class="label">Design load</div>
                        <div class="value" id="designLoad">‚Äî</div>
                    </div>
                    <div class="result-card">
                        <div class="label">Shaft resistance</div>
                        <div class="value" id="shaftRes">‚Äî</div>
                    </div>
                    <div class="result-card">
                        <div class="label">Base resistance</div>
                        <div class="value" id="baseRes">‚Äî</div>
                    </div>
                </div>
            </div>

            <div class="tool-panel" id="panel-beam" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Beam Section Selection</div>
                        <div class="panel-subtitle">Bending + deflection check</div>
                    </div>
                    <button class="primary-btn" id="runBeam">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field">
                        <label>Material</label>
                        <select id="beamMaterial">
                            <option value="steel">Steel</option>
                            <option value="rc">Reinforced Concrete</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>f<sub>y</sub> (MPa)</label>
                        <input id="beamFy" type="number" step="1" value="235" />
                    </div>
                    <div class="field">
                        <label>E (GPa)</label>
                        <input id="beamE" type="number" step="1" value="200" />
                    </div>
                    <div class="field">
                        <label>Span (m)</label>
                        <input id="beamSpan" type="number" step="0.1" value="6" />
                    </div>
                    <div class="field">
                        <label>UDL (kN/m)</label>
                        <input id="beamUDL" type="number" step="0.1" value="20" />
                    </div>
                    <div class="field">
                        <label>Width (m)</label>
                        <input id="beamWidth" type="number" step="0.01" value="0.3" />
                    </div>
                    <div class="field">
                        <label>Height (m, optional)</label>
                        <input id="beamHeight" type="number" step="0.01" value="0" />
                    </div>
                    <div class="field">
                        <label>Deflection limit (L/)</label>
                        <input id="beamDefl" type="number" step="1" value="250" />
                    </div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Max moment</div><div class="value" id="beamM">‚Äî</div></div>
                    <div class="result-card"><div class="label">Required height</div><div class="value" id="beamH">‚Äî</div></div>
                    <div class="result-card"><div class="label">Stress</div><div class="value" id="beamStress">‚Äî</div></div>
                    <div class="result-card"><div class="label">Deflection</div><div class="value" id="beamDeflection">‚Äî</div></div>
                    <div class="result-card"><div class="label">Deflection limit</div><div class="value" id="beamDeflLimit">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="beamOK">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-loads" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Load Combination</div>
                        <div class="panel-subtitle">SP/EC7 simplified</div>
                    </div>
                    <button class="primary-btn" id="runLoads">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field">
                        <label>Method</label>
                        <select id="loadsMethod">
                            <option value="SP24">SP 24.13330</option>
                            <option value="SP22">SP 22.13330</option>
                            <option value="EC7">EN 1997-1 (EC7)</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>G (kN)</label>
                        <input id="loadsG" type="number" step="1" value="15000" />
                    </div>
                    <div class="field">
                        <label>Q long (kN)</label>
                        <input id="loadsQLong" type="number" step="1" value="4000" />
                    </div>
                    <div class="field">
                        <label>Q short (kN)</label>
                        <input id="loadsQShort" type="number" step="1" value="2000" />
                    </div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Design load</div><div class="value" id="loadsDesign">‚Äî</div></div>
                    <div class="result-card"><div class="label">Combination</div><div class="value" id="loadsCombo">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-anchors" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Anchor Check</div>
                        <div class="panel-subtitle">Tension + shear</div>
                    </div>
                    <button class="primary-btn" id="runAnchors">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Bolt diameter (mm)</label><input id="ancD" type="number" step="1" value="20" /></div>
                    <div class="field"><label>Count</label><input id="ancN" type="number" step="1" value="4" /></div>
                    <div class="field"><label>f<sub>y</sub> (MPa)</label><input id="ancFy" type="number" step="1" value="400" /></div>
                    <div class="field"><label>Œ≥<sub>M</sub></label><input id="ancGamma" type="number" step="0.01" value="1.25" /></div>
                    <div class="field"><label>Tension (kN)</label><input id="ancT" type="number" step="1" value="100" /></div>
                    <div class="field"><label>Shear (kN)</label><input id="ancV" type="number" step="1" value="50" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Tension capacity</div><div class="value" id="ancNrd">‚Äî</div></div>
                    <div class="result-card"><div class="label">Shear capacity</div><div class="value" id="ancVrd">‚Äî</div></div>
                    <div class="result-card"><div class="label">Utilization</div><div class="value" id="ancUtil">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="ancOK">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-deflection" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Deflection Check</div>
                        <div class="panel-subtitle">Simply supported, UDL</div>
                    </div>
                    <button class="primary-btn" id="runDeflection">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Span (m)</label><input id="defL" type="number" step="0.1" value="6" /></div>
                    <div class="field"><label>UDL (kN/m)</label><input id="defW" type="number" step="0.1" value="20" /></div>
                    <div class="field"><label>E (GPa)</label><input id="defE" type="number" step="1" value="200" /></div>
                    <div class="field"><label>Width (m)</label><input id="defB" type="number" step="0.01" value="0.3" /></div>
                    <div class="field"><label>Height (m)</label><input id="defH" type="number" step="0.01" value="0.5" /></div>
                    <div class="field"><label>Limit (L/)</label><input id="defLim" type="number" step="1" value="250" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Deflection</div><div class="value" id="defValue">‚Äî</div></div>
                    <div class="result-card"><div class="label">Limit</div><div class="value" id="defLimit">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="defOK">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-joints" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Weld Check</div>
                        <div class="panel-subtitle">Fillet weld shear</div>
                    </div>
                    <button class="primary-btn" id="runJoints">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Weld size (mm)</label><input id="jSize" type="number" step="1" value="6" /></div>
                    <div class="field"><label>Weld length (mm)</label><input id="jLen" type="number" step="1" value="200" /></div>
                    <div class="field"><label>f<sub>vw</sub> (MPa)</label><input id="jFvw" type="number" step="1" value="180" /></div>
                    <div class="field"><label>Œ≥<sub>M</sub></label><input id="jGamma" type="number" step="0.01" value="1.25" /></div>
                    <div class="field"><label>Shear (kN)</label><input id="jV" type="number" step="1" value="60" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Capacity</div><div class="value" id="jCap">‚Äî</div></div>
                    <div class="result-card"><div class="label">Utilization</div><div class="value" id="jUtil">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="jOK">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-report" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">PDF Report</div>
                        <div class="panel-subtitle">Simple project report</div>
                    </div>
                    <button class="primary-btn" id="runReport">Generate PDF</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Project</label><input id="repProject" type="text" value="Project A" /></div>
                    <div class="field"><label>Author</label><input id="repAuthor" type="text" value="Engineer" /></div>
                    <div class="field"><label>Title</label><input id="repTitle" type="text" value="Engineering Report" /></div>
                    <div class="field" style="grid-column: 1 / -1;">
                        <label>Notes</label>
                        <textarea id="repNotes">Calculation summary and conclusions.</textarea>
                    </div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Status</div><div class="value" id="repStatus">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-column" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Column Stability</div>
                        <div class="panel-subtitle">Euler buckling</div>
                    </div>
                    <button class="primary-btn" id="runColumn">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Length (m)</label><input id="colL" type="number" step="0.1" value="3" /></div>
                    <div class="field"><label>k-factor</label><input id="colK" type="number" step="0.1" value="1" /></div>
                    <div class="field"><label>Width (m)</label><input id="colB" type="number" step="0.01" value="0.3" /></div>
                    <div class="field"><label>Height (m)</label><input id="colH" type="number" step="0.01" value="0.3" /></div>
                    <div class="field"><label>E (GPa)</label><input id="colE" type="number" step="1" value="200" /></div>
                    <div class="field"><label>Load (kN)</label><input id="colN" type="number" step="1" value="800" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Pcr</div><div class="value" id="colPcr">‚Äî</div></div>
                    <div class="result-card"><div class="label">Utilization</div><div class="value" id="colUtil">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="colOK">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-slab" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Slab Reinforcement</div>
                        <div class="panel-subtitle">Simple flexural design</div>
                    </div>
                    <button class="primary-btn" id="runSlab">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Moment (kN¬∑m/m)</label><input id="slabM" type="number" step="0.1" value="80" /></div>
                    <div class="field"><label>Effective depth d (mm)</label><input id="slabD" type="number" step="1" value="180" /></div>
                    <div class="field"><label>f<sub>yd</sub> (MPa)</label><input id="slabFyd" type="number" step="1" value="435" /></div>
                    <div class="field"><label>Bar diameter (mm)</label><input id="slabBar" type="number" step="1" value="12" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">As required</div><div class="value" id="slabAs">‚Äî</div></div>
                    <div class="result-card"><div class="label">Bar area</div><div class="value" id="slabArea">‚Äî</div></div>
                    <div class="result-card"><div class="label">Spacing</div><div class="value" id="slabSpacing">‚Äî</div></div>
                </div>
            </div>
            <div class="tool-panel" id="panel-piles-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Pile Foundation (SP)</div>
                        <div class="panel-subtitle">Input data and calculate</div>
                    </div>
                    <button class="primary-btn" id="runPilesSp">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field">
                        <label>Method</label>
                        <select id="methodSp">
                            <option value="SP24">SP 24.13330</option>
                            <option value="SP22">SP 22.13330</option>
                            <option value="EC7">EN 1997-1 (EC7)</option>
                        </select>
                    </div>
                    <div class="field"><label>Pile type</label>
                        <select id="pileTypeSp"><option value="square">Square</option><option value="round">Round</option></select>
                    </div>
                    <div class="field"><label>Side (m)</label><input id="sideMSp" type="number" step="0.01" value="0.4" /></div>
                    <div class="field"><label>Diameter (m)</label><input id="diameterMSp" type="number" step="0.01" value="0.4" /></div>
                    <div class="field"><label>Length (m)</label><input id="lengthMSp" type="number" step="0.1" value="12" /></div>
                    <div class="field"><label>Toe depth (m)</label><input id="toeDepthMSp" type="number" step="0.1" value="12" /></div>
                    <div class="field"><label>Base resistance q<sub>b</sub> (kPa)</label><input id="baseQbSp" type="number" step="1" value="3000" /></div>
                    <div class="field"><label>G (kN)</label><input id="loadGSp" type="number" step="1" value="15000" /></div>
                    <div class="field"><label>Q long (kN)</label><input id="loadQLongSp" type="number" step="1" value="4000" /></div>
                    <div class="field"><label>Q short (kN)</label><input id="loadQShortSp" type="number" step="1" value="2000" /></div>
                </div>
                <div class="layers">
                    <div class="layers-header">
                        <div class="panel-title">Soil layers</div>
                        <button class="ghost-btn" id="addLayerSp">Add layer</button>
                    </div>
                    <div id="layersGridSp"></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Average load per pile</div><div class="value" id="avgLoadSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">Pile count</div><div class="value" id="pileCountSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">Design resistance</div><div class="value" id="designResSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">Design load</div><div class="value" id="designLoadSp">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-beam-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">RC Beam (SP 63)</div>
                        <div class="panel-subtitle">Rectangular section flexure</div>
                    </div>
                    <button class="primary-btn" id="runBeamSp">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Moment (kN¬∑m)</label><input id="beamSpM" type="number" step="0.1" value="200" /></div>
                    <div class="field"><label>b (mm)</label><input id="beamSpB" type="number" step="1" value="300" /></div>
                    <div class="field"><label>h<sub>0</sub> (mm)</label><input id="beamSpH0" type="number" step="1" value="500" /></div>
                    <div class="field"><label>R<sub>b</sub> (MPa)</label><input id="beamSpRb" type="number" step="0.1" value="14" /></div>
                    <div class="field"><label>R<sub>s</sub> (MPa)</label><input id="beamSpRs" type="number" step="1" value="365" /></div>
                    <div class="field"><label>Œæ<sub>R</sub></label><input id="beamSpXi" type="number" step="0.01" value="0.45" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Compression zone x</div><div class="value" id="beamSpX">‚Äî</div></div>
                    <div class="result-card"><div class="label">As required</div><div class="value" id="beamSpAs">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="beamSpOk">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-loads-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Loads (SP)</div>
                        <div class="panel-subtitle">Simplified combination</div>
                    </div>
                    <button class="primary-btn" id="runLoadsSp">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Method</label>
                        <select id="loadsMethodSp"><option value="SP24">SP 24.13330</option><option value="SP22">SP 22.13330</option><option value="EC7">EN 1997-1 (EC7)</option></select>
                    </div>
                    <div class="field"><label>G (kN)</label><input id="loadsGSp" type="number" step="1" value="15000" /></div>
                    <div class="field"><label>Q long (kN)</label><input id="loadsQLongSp" type="number" step="1" value="4000" /></div>
                    <div class="field"><label>Q short (kN)</label><input id="loadsQShortSp" type="number" step="1" value="2000" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Design load</div><div class="value" id="loadsDesignSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">Combination</div><div class="value" id="loadsComboSp">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-anchors-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Anchors (SP)</div>
                        <div class="panel-subtitle">Placeholder</div>
                    </div>
                    <button class="primary-btn" id="runAnchorsSp">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Bolt diameter (mm)</label><input id="ancDSp" type="number" step="1" value="20" /></div>
                    <div class="field"><label>Count</label><input id="ancNSp" type="number" step="1" value="4" /></div>
                    <div class="field"><label>f<sub>y</sub> (MPa)</label><input id="ancFySp" type="number" step="1" value="400" /></div>
                    <div class="field"><label>Œ≥<sub>M</sub></label><input id="ancGammaSp" type="number" step="0.01" value="1.25" /></div>
                    <div class="field"><label>Tension (kN)</label><input id="ancTSp" type="number" step="1" value="100" /></div>
                    <div class="field"><label>Shear (kN)</label><input id="ancVSp" type="number" step="1" value="50" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Tension capacity</div><div class="value" id="ancNrdSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">Shear capacity</div><div class="value" id="ancVrdSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">Utilization</div><div class="value" id="ancUtilSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="ancOKSp">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-deflection-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Deflection (SP 63)</div>
                        <div class="panel-subtitle">Simply supported, UDL</div>
                    </div>
                    <button class="primary-btn" id="runDeflectionSp">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Span (m)</label><input id="defLSp" type="number" step="0.1" value="6" /></div>
                    <div class="field"><label>UDL (kN/m)</label><input id="defWSp" type="number" step="0.1" value="20" /></div>
                    <div class="field"><label>E (GPa)</label><input id="defESp" type="number" step="1" value="30" /></div>
                    <div class="field"><label>Width (m)</label><input id="defBSp" type="number" step="0.01" value="0.3" /></div>
                    <div class="field"><label>Height (m)</label><input id="defHSp" type="number" step="0.01" value="0.5" /></div>
                    <div class="field"><label>Limit (L/)</label><input id="defLimSp" type="number" step="1" value="250" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Deflection</div><div class="value" id="defValueSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">Limit</div><div class="value" id="defLimitSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="defOKSp">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-joints-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Welds (SP)</div>
                        <div class="panel-subtitle">Placeholder</div>
                    </div>
                    <button class="primary-btn" id="runJointsSp">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Weld size (mm)</label><input id="jSizeSp" type="number" step="1" value="6" /></div>
                    <div class="field"><label>Weld length (mm)</label><input id="jLenSp" type="number" step="1" value="200" /></div>
                    <div class="field"><label>f<sub>vw</sub> (MPa)</label><input id="jFvwSp" type="number" step="1" value="180" /></div>
                    <div class="field"><label>Œ≥<sub>M</sub></label><input id="jGammaSp" type="number" step="0.01" value="1.25" /></div>
                    <div class="field"><label>Shear (kN)</label><input id="jVSp" type="number" step="1" value="60" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Capacity</div><div class="value" id="jCapSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">Utilization</div><div class="value" id="jUtilSp">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="jOKSp">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-column-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">RC Column (SP 63)</div>
                        <div class="panel-subtitle">Axial capacity</div>
                    </div>
                    <button class="primary-btn" id="runColumnSp">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>b (mm)</label><input id="colSpB" type="number" step="1" value="300" /></div>
                    <div class="field"><label>h (mm)</label><input id="colSpH" type="number" step="1" value="300" /></div>
                    <div class="field"><label>R<sub>b</sub> (MPa)</label><input id="colSpRb" type="number" step="0.1" value="14" /></div>
                    <div class="field"><label>R<sub>s</sub> (MPa)</label><input id="colSpRs" type="number" step="1" value="365" /></div>
                    <div class="field"><label>As (mm¬≤)</label><input id="colSpAs" type="number" step="1" value="1200" /></div>
                    <div class="field"><label>N (kN)</label><input id="colSpN" type="number" step="1" value="800" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Capacity</div><div class="value" id="colSpCap">‚Äî</div></div>
                    <div class="result-card"><div class="label">Utilization</div><div class="value" id="colSpUtil">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="colSpOK">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-slab-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">RC Slab (SP 63)</div>
                        <div class="panel-subtitle">Flexural design</div>
                    </div>
                    <button class="primary-btn" id="runSlabSp">Calculate</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Moment (kN¬∑m/m)</label><input id="slabSpM" type="number" step="0.1" value="80" /></div>
                    <div class="field"><label>h<sub>0</sub> (mm)</label><input id="slabSpD" type="number" step="1" value="180" /></div>
                    <div class="field"><label>R<sub>b</sub> (MPa)</label><input id="slabSpRb" type="number" step="0.1" value="14" /></div>
                    <div class="field"><label>R<sub>s</sub> (MPa)</label><input id="slabSpRs" type="number" step="1" value="365" /></div>
                    <div class="field"><label>Bar √ò (mm)</label><input id="slabSpBar" type="number" step="1" value="12" /></div>
                    <div class="field"><label>Œæ<sub>R</sub></label><input id="slabSpXi" type="number" step="0.01" value="0.45" /></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">As required</div><div class="value" id="slabSpAs">‚Äî</div></div>
                    <div class="result-card"><div class="label">Bar area</div><div class="value" id="slabSpArea">‚Äî</div></div>
                    <div class="result-card"><div class="label">Spacing</div><div class="value" id="slabSpSpacing">‚Äî</div></div>
                    <div class="result-card"><div class="label">OK</div><div class="value" id="slabSpOK">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-report-sp" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">PDF Report (SP)</div>
                        <div class="panel-subtitle">Simple project report</div>
                    </div>
                    <button class="primary-btn" id="runReportSp">Generate PDF</button>
                </div>
                <div class="form-grid">
                    <div class="field"><label>Project</label><input id="repProjectSp" type="text" value="Project A" /></div>
                    <div class="field"><label>Author</label><input id="repAuthorSp" type="text" value="Engineer" /></div>
                    <div class="field"><label>Title</label><input id="repTitleSp" type="text" value="Engineering Report" /></div>
                    <div class="field" style="grid-column: 1 / -1;"><label>Notes</label><textarea id="repNotesSp">Calculation summary and conclusions.</textarea></div>
                </div>
                <div class="panel-grid">
                    <div class="result-card"><div class="label">Status</div><div class="value" id="repStatusSp">‚Äî</div></div>
                </div>
            </div>

            <div class="tool-panel" id="panel-info" style="display:none;">
                <div class="panel-header">
                    <div>
                        <div class="panel-title">Documents</div>
                        <div class="panel-subtitle">Files from /docs</div>
                    </div>
                    <button class="primary-btn" id="refreshDocs">Refresh</button>
                </div>
                <div class="panel-grid" id="docsList"></div>
            </div>

        </main>

        <div class="right ">
            <button class="premium-pill" id="buyPremium">–ö—É–ø–∏—Ç—å Premium</button>
            <a href="/profile/" class="user-chip">
                <img id="userAvatar" alt="Avatar" />
                <div class="user-text">
                    <div class="login" id="userLogin">@loading</div>
                    <div class="hint">Profile</div>
                </div>
            </a>
        </div>
</div>

    <script>
        (async () => {
            try {
                const res = await fetch('/api/user/profile', { credentials: 'include' });
                if (res.status === 401) {
                    window.location.href = '/auth/';
                    return;
                }
                if (!res.ok) return;
                const user = await res.json();
                document.getElementById('userLogin').textContent = '@' + user.login;
                document.getElementById('userAvatar').src =
                    user.avatar_url || `https://ui-avatars.com/api/?name=${user.login}`;
                isPremium = !!user.is_premium;
                setPremiumUI();
                const premRes = await fetch('/api/user/premium/status', { credentials: 'include' });
                if (premRes.ok) {
                    const prem = await premRes.json();
                    isPremium = !!prem.active;
                    setPremiumUI();
                }
            } catch (_) {}
        })();

        const emptyState = document.getElementById('emptyState');
        const panels = document.querySelectorAll('.tool-panel');
                emptyState.style.display = 'block';
        panels.forEach(p => p.style.display = 'none');

document.querySelectorAll('.tool-card').forEach(card => {
            card.addEventListener('click', () => {
                if (card.dataset.premium === 'true' && !isPremium) {
                    alert('–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —Å Premium');
                    return;
                }
                const target = card.getAttribute('data-target');
                emptyState.style.display = 'none';
                panels.forEach(p => p.style.display = 'none');
                const panel = document.getElementById(`panel-${target}`);
                if (panel) panel.style.display = 'block';
                if (target === 'info') { loadDocs(); }
            });
        });

        // Piles
        const layersGrid = document.getElementById('layersGrid');
        const addLayer = document.getElementById('addLayer');

        if (layersGrid) {
            layersGrid.addEventListener('click', (e) => {
                const btn = e.target.closest('.remove-btn');
                if (btn) {
                    const row = btn.closest('.layer-grid');
                    if (row) row.remove();
                }
            });
        }
        const createLayerRow = (data = {}) => {
            const row = document.createElement('div');
            row.className = 'layer-grid';
            row.innerHTML = `
                <input type="number" step="0.1" placeholder="From (m)" value="${data.from_depth_m ?? 0}">
                <input type="number" step="0.1" placeholder="To (m)" value="${data.to_depth_m ?? 3}">
                <input type="text" placeholder="Soil" value="${data.soil_type ?? 'Sand'}">
                <input type="number" step="0.1" placeholder="Œ≥ (kN/m¬≥)" value="${data.gamma_kn_m3 ?? 18}">
                <input type="number" step="1" placeholder="f·µ¢ (kPa)" value="${data.fi_kpa ?? 25}">
                <input type="number" step="0.01" placeholder="Œ±" value="${data.alpha ?? 1}">
                <button type="button" class="remove-btn">Remove</button>
            `;
            layersGrid.appendChild(row);
        };
        addLayer.addEventListener('click', () => createLayerRow());
        createLayerRow({ from_depth_m: 0, to_depth_m: 4, soil_type: 'Sand', gamma_kn_m3: 18, fi_kpa: 25, alpha: 1 });
        createLayerRow({ from_depth_m: 4, to_depth_m: 10, soil_type: 'Clay', gamma_kn_m3: 19, fi_kpa: 35, alpha: 0.7 });

        document.getElementById('runPiles').addEventListener('click', async () => {
            try {
                const layers = Array.from(layersGrid.children).map(row => {
                    const inputs = row.querySelectorAll('input');
                    return {
                        from_depth_m: parseFloat(inputs[0].value),
                        to_depth_m: parseFloat(inputs[1].value),
                        soil_type: inputs[2].value,
                        gamma_kn_m3: parseFloat(inputs[3].value),
                        fi_kpa: parseFloat(inputs[4].value),
                        alpha: parseFloat(inputs[5].value)
                    };
                });
                const payload = {
                    method: document.getElementById('method').value,
                    pile_type: document.getElementById('pileType').value,
                    side_m: parseFloat(document.getElementById('sideM').value),
                    diameter_m: parseFloat(document.getElementById('diameterM').value),
                    length_m: parseFloat(document.getElementById('lengthM').value),
                    toe_depth_m: parseFloat(document.getElementById('toeDepthM').value),
                    base_qb_kpa: parseFloat(document.getElementById('baseQb').value),
                    load_g_kn: parseFloat(document.getElementById('loadG').value),
                    load_q_long_kn: parseFloat(document.getElementById('loadQLong').value),
                    load_q_short_kn: parseFloat(document.getElementById('loadQShort').value),
                    layers
                };
                const res = await fetch('/api/user/tools/piles/calc', {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                document.getElementById('avgLoad').textContent = data.average_load_per_pile?.toFixed(2) + ' kN';
                document.getElementById('pileCount').textContent = data.pile_count ?? '‚Äî';
                document.getElementById('designRes').textContent = data.design_resistance_kn?.toFixed(2) + ' kN';
                document.getElementById('designLoad').textContent = data.design_load_kn?.toFixed(2) + ' kN';
                document.getElementById('shaftRes').textContent = data.shaft_resistance_kn?.toFixed(2) + ' kN';
                document.getElementById('baseRes').textContent = data.base_resistance_kn?.toFixed(2) + ' kN';
            } catch (_) { alert('Calculation failed'); }
        });

        // Beam
        document.getElementById('runBeam').addEventListener('click', async () => {
            const payload = {
                material: document.getElementById('beamMaterial').value,
                fy_mpa: parseFloat(document.getElementById('beamFy').value),
                e_gpa: parseFloat(document.getElementById('beamE').value),
                span_m: parseFloat(document.getElementById('beamSpan').value),
                udl_kn_m: parseFloat(document.getElementById('beamUDL').value),
                width_m: parseFloat(document.getElementById('beamWidth').value),
                height_m: parseFloat(document.getElementById('beamHeight').value),
                deflection_limit_ratio: parseFloat(document.getElementById('beamDefl').value)
            };
            const res = await fetch('/api/user/tools/beam/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('beamM').textContent = data.max_moment_knm?.toFixed(2) + ' kN¬∑m';
            document.getElementById('beamH').textContent = data.required_height_m?.toFixed(3) + ' m';
            document.getElementById('beamStress').textContent = data.stress_mpa?.toFixed(1) + ' MPa';
            document.getElementById('beamDeflection').textContent = data.deflection_mm?.toFixed(2) + ' mm';
            document.getElementById('beamDeflLimit').textContent = data.deflection_limit_mm?.toFixed(2) + ' mm';
            document.getElementById('beamOK').textContent = data.ok_stress && data.ok_deflection ? 'OK' : 'Fail';
        });

        // Loads
        document.getElementById('runLoads').addEventListener('click', async () => {
            const payload = {
                method: document.getElementById('loadsMethod').value,
                load_g_kn: parseFloat(document.getElementById('loadsG').value),
                load_q_long_kn: parseFloat(document.getElementById('loadsQLong').value),
                load_q_short_kn: parseFloat(document.getElementById('loadsQShort').value)
            };
            const res = await fetch('/api/user/tools/loads/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('loadsDesign').textContent = data.design_load_kn?.toFixed(2) + ' kN';
            document.getElementById('loadsCombo').textContent = data.combo_name || '‚Äî';
        });

        // Anchors
        document.getElementById('runAnchors').addEventListener('click', async () => {
            const payload = {
                bolt_diameter_mm: parseFloat(document.getElementById('ancD').value),
                bolt_count: parseInt(document.getElementById('ancN').value, 10),
                fy_mpa: parseFloat(document.getElementById('ancFy').value),
                gamma_m: parseFloat(document.getElementById('ancGamma').value),
                tension_kn: parseFloat(document.getElementById('ancT').value),
                shear_kn: parseFloat(document.getElementById('ancV').value)
            };
            const res = await fetch('/api/user/tools/anchors/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('ancNrd').textContent = data.tension_capacity_kn?.toFixed(2) + ' kN';
            document.getElementById('ancVrd').textContent = data.shear_capacity_kn?.toFixed(2) + ' kN';
            document.getElementById('ancUtil').textContent = data.utilization?.toFixed(2);
            document.getElementById('ancOK').textContent = data.ok ? 'OK' : 'Fail';
        });

        // Deflection
        document.getElementById('runDeflection').addEventListener('click', async () => {
            const payload = {
                span_m: parseFloat(document.getElementById('defL').value),
                udl_kn_m: parseFloat(document.getElementById('defW').value),
                e_gpa: parseFloat(document.getElementById('defE').value),
                width_m: parseFloat(document.getElementById('defB').value),
                height_m: parseFloat(document.getElementById('defH').value),
                deflection_limit_ratio: parseFloat(document.getElementById('defLim').value)
            };
            const res = await fetch('/api/user/tools/deflection/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('defValue').textContent = data.deflection_mm?.toFixed(2) + ' mm';
            document.getElementById('defLimit').textContent = data.deflection_limit_mm?.toFixed(2) + ' mm';
            document.getElementById('defOK').textContent = data.ok ? 'OK' : 'Fail';
        });

        // Joints
        document.getElementById('runJoints').addEventListener('click', async () => {
            const payload = {
                weld_size_mm: parseFloat(document.getElementById('jSize').value),
                weld_length_mm: parseFloat(document.getElementById('jLen').value),
                fvw_mpa: parseFloat(document.getElementById('jFvw').value),
                gamma_m: parseFloat(document.getElementById('jGamma').value),
                shear_kn: parseFloat(document.getElementById('jV').value)
            };
            const res = await fetch('/api/user/tools/joints/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('jCap').textContent = data.capacity_kn?.toFixed(2) + ' kN';
            document.getElementById('jUtil').textContent = data.utilization?.toFixed(2);
            document.getElementById('jOK').textContent = data.ok ? 'OK' : 'Fail';
        });

        // Report
        document.getElementById('runReport').addEventListener('click', async () => {
            const payload = {
                project: document.getElementById('repProject').value,
                author: document.getElementById('repAuthor').value,
                title: document.getElementById('repTitle').value,
                notes: document.getElementById('repNotes').value
            };
            const res = await fetch('/api/user/tools/report/pdf', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!res.ok) { document.getElementById('repStatus').textContent = 'Error'; return; }
            const blob = await res.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'report.pdf';
            a.click();
            URL.revokeObjectURL(url);
            document.getElementById('repStatus').textContent = 'Downloaded';
        });

        // Column
        document.getElementById('runColumn').addEventListener('click', async () => {
            const payload = {
                length_m: parseFloat(document.getElementById('colL').value),
                k_factor: parseFloat(document.getElementById('colK').value),
                width_m: parseFloat(document.getElementById('colB').value),
                height_m: parseFloat(document.getElementById('colH').value),
                e_gpa: parseFloat(document.getElementById('colE').value),
                load_kn: parseFloat(document.getElementById('colN').value)
            };
            const res = await fetch('/api/user/tools/column/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('colPcr').textContent = data.pcr_kn?.toFixed(2) + ' kN';
            document.getElementById('colUtil').textContent = data.utilization?.toFixed(2);
            document.getElementById('colOK').textContent = data.ok ? 'OK' : 'Fail';
        });

        // Slab
        document.getElementById('runSlab').addEventListener('click', async () => {
            const payload = {
                moment_knm_per_m: parseFloat(document.getElementById('slabM').value),
                effective_depth_mm: parseFloat(document.getElementById('slabD').value),
                fyd_mpa: parseFloat(document.getElementById('slabFyd').value),
                bar_diameter_mm: parseFloat(document.getElementById('slabBar').value)
            };
            const res = await fetch('/api/user/tools/slab/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('slabAs').textContent = data.as_required_mm2_per_m?.toFixed(1) + ' mm¬≤/m';
            document.getElementById('slabArea').textContent = data.bar_area_mm2?.toFixed(1) + ' mm¬≤';
            document.getElementById('slabSpacing').textContent = data.spacing_mm?.toFixed(0) + ' mm';
        });
        // SP Piles
        const layersGridSp = document.getElementById('layersGridSp');
        const addLayerSp = document.getElementById('addLayerSp');
        if (layersGridSp) {
            layersGridSp.addEventListener('click', (e) => {
                const btn = e.target.closest('.remove-btn');
                if (btn) {
                    const row = btn.closest('.layer-grid');
                    if (row) row.remove();
                }
            });
        }
        const createLayerRowSp = (data = {}) => {
            const row = document.createElement('div');
            row.className = 'layer-grid';
            row.innerHTML = `
                <input type="number" step="0.1" placeholder="From (m)" value="${data.from_depth_m ?? 0}">
                <input type="number" step="0.1" placeholder="To (m)" value="${data.to_depth_m ?? 3}">
                <input type="text" placeholder="Soil" value="${data.soil_type ?? 'Sand'}">
                <input type="number" step="0.1" placeholder="Œ≥ (kN/m¬≥)" value="${data.gamma_kn_m3 ?? 18}">
                <input type="number" step="1" placeholder="f·µ¢ (kPa)" value="${data.fi_kpa ?? 25}">
                <input type="number" step="0.01" placeholder="Œ±" value="${data.alpha ?? 1}">
                <button type="button" class="remove-btn">Remove</button>
            `;
            layersGridSp.appendChild(row);
        };
        addLayerSp.addEventListener('click', () => createLayerRowSp());
        createLayerRowSp({ from_depth_m: 0, to_depth_m: 4, soil_type: 'Sand', gamma_kn_m3: 18, fi_kpa: 25, alpha: 1 });
        createLayerRowSp({ from_depth_m: 4, to_depth_m: 10, soil_type: 'Clay', gamma_kn_m3: 19, fi_kpa: 35, alpha: 0.7 });

        document.getElementById('runPilesSp').addEventListener('click', async () => {
            try {
                const layers = Array.from(layersGridSp.children).map(row => {
                    const inputs = row.querySelectorAll('input');
                    return {
                        from_depth_m: parseFloat(inputs[0].value),
                        to_depth_m: parseFloat(inputs[1].value),
                        soil_type: inputs[2].value,
                        gamma_kn_m3: parseFloat(inputs[3].value),
                        fi_kpa: parseFloat(inputs[4].value),
                        alpha: parseFloat(inputs[5].value)
                    };
                });
                const payload = {
                    method: document.getElementById('methodSp').value,
                    pile_type: document.getElementById('pileTypeSp').value,
                    side_m: parseFloat(document.getElementById('sideMSp').value),
                    diameter_m: parseFloat(document.getElementById('diameterMSp').value),
                    length_m: parseFloat(document.getElementById('lengthMSp').value),
                    toe_depth_m: parseFloat(document.getElementById('toeDepthMSp').value),
                    base_qb_kpa: parseFloat(document.getElementById('baseQbSp').value),
                    load_g_kn: parseFloat(document.getElementById('loadGSp').value),
                    load_q_long_kn: parseFloat(document.getElementById('loadQLongSp').value),
                    load_q_short_kn: parseFloat(document.getElementById('loadQShortSp').value),
                    layers
                };
                const res = await fetch('/api/user/tools-sp/piles/calc', {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                document.getElementById('avgLoadSp').textContent = data.average_load_per_pile?.toFixed(2) + ' kN';
                document.getElementById('pileCountSp').textContent = data.pile_count ?? '‚Äî';
                document.getElementById('designResSp').textContent = data.design_resistance_kn?.toFixed(2) + ' kN';
                document.getElementById('designLoadSp').textContent = data.design_load_kn?.toFixed(2) + ' kN';
            } catch (_) { alert('SP calculation failed'); }
        });

        // SP Beam
        document.getElementById('runBeamSp').addEventListener('click', async () => {
            const payload = {
                moment_knm: parseFloat(document.getElementById('beamSpM').value),
                width_mm: parseFloat(document.getElementById('beamSpB').value),
                effective_depth_mm: parseFloat(document.getElementById('beamSpH0').value),
                rb_mpa: parseFloat(document.getElementById('beamSpRb').value),
                rs_mpa: parseFloat(document.getElementById('beamSpRs').value),
                xi_r: parseFloat(document.getElementById('beamSpXi').value)
            };
            const res = await fetch('/api/user/tools-sp/beam/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('beamSpX').textContent = data.compression_zone_x_mm?.toFixed(1) + ' mm';
            document.getElementById('beamSpAs').textContent = data.as_required_mm2?.toFixed(1) + ' mm¬≤';
            document.getElementById('beamSpOk').textContent = data.ok ? 'OK' : 'Fail';
        });

        // SP Loads
        document.getElementById('runLoadsSp').addEventListener('click', async () => {
            const payload = {
                method: document.getElementById('loadsMethodSp').value,
                load_g_kn: parseFloat(document.getElementById('loadsGSp').value),
                load_q_long_kn: parseFloat(document.getElementById('loadsQLongSp').value),
                load_q_short_kn: parseFloat(document.getElementById('loadsQShortSp').value)
            };
            const res = await fetch('/api/user/tools-sp/loads/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('loadsDesignSp').textContent = data.design_load_kn?.toFixed(2) + ' kN';
            document.getElementById('loadsComboSp').textContent = data.combo_name || '‚Äî';
        });

        // SP Anchors
        document.getElementById('runAnchorsSp').addEventListener('click', async () => {
            const payload = {
                bolt_diameter_mm: parseFloat(document.getElementById('ancDSp').value),
                bolt_count: parseInt(document.getElementById('ancNSp').value, 10),
                fy_mpa: parseFloat(document.getElementById('ancFySp').value),
                gamma_m: parseFloat(document.getElementById('ancGammaSp').value),
                tension_kn: parseFloat(document.getElementById('ancTSp').value),
                shear_kn: parseFloat(document.getElementById('ancVSp').value)
            };
            const res = await fetch('/api/user/tools-sp/anchors/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('ancNrdSp').textContent = data.tension_capacity_kn?.toFixed(2) + ' kN';
            document.getElementById('ancVrdSp').textContent = data.shear_capacity_kn?.toFixed(2) + ' kN';
            document.getElementById('ancUtilSp').textContent = data.utilization?.toFixed(2);
            document.getElementById('ancOKSp').textContent = data.ok ? 'OK' : 'Fail';
        });

        // SP Deflection
        document.getElementById('runDeflectionSp').addEventListener('click', async () => {
            const payload = {
                span_m: parseFloat(document.getElementById('defLSp').value),
                udl_kn_m: parseFloat(document.getElementById('defWSp').value),
                e_gpa: parseFloat(document.getElementById('defESp').value),
                width_m: parseFloat(document.getElementById('defBSp').value),
                height_m: parseFloat(document.getElementById('defHSp').value),
                deflection_limit_ratio: parseFloat(document.getElementById('defLimSp').value)
            };
            const res = await fetch('/api/user/tools-sp/deflection/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('defValueSp').textContent = data.deflection_mm?.toFixed(2) + ' mm';
            document.getElementById('defLimitSp').textContent = data.deflection_limit_mm?.toFixed(2) + ' mm';
            document.getElementById('defOKSp').textContent = data.ok ? 'OK' : 'Fail';
        });

        // SP Joints
        document.getElementById('runJointsSp').addEventListener('click', async () => {
            const payload = {
                weld_size_mm: parseFloat(document.getElementById('jSizeSp').value),
                weld_length_mm: parseFloat(document.getElementById('jLenSp').value),
                fvw_mpa: parseFloat(document.getElementById('jFvwSp').value),
                gamma_m: parseFloat(document.getElementById('jGammaSp').value),
                shear_kn: parseFloat(document.getElementById('jVSp').value)
            };
            const res = await fetch('/api/user/tools-sp/joints/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('jCapSp').textContent = data.capacity_kn?.toFixed(2) + ' kN';
            document.getElementById('jUtilSp').textContent = data.utilization?.toFixed(2);
            document.getElementById('jOKSp').textContent = data.ok ? 'OK' : 'Fail';
        });

        // SP Column
        document.getElementById('runColumnSp').addEventListener('click', async () => {
            const payload = {
                width_mm: parseFloat(document.getElementById('colSpB').value),
                height_mm: parseFloat(document.getElementById('colSpH').value),
                rb_mpa: parseFloat(document.getElementById('colSpRb').value),
                rs_mpa: parseFloat(document.getElementById('colSpRs').value),
                as_mm2: parseFloat(document.getElementById('colSpAs').value),
                load_kn: parseFloat(document.getElementById('colSpN').value)
            };
            const res = await fetch('/api/user/tools-sp/column/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('colSpCap').textContent = data.capacity_kn?.toFixed(2) + ' kN';
            document.getElementById('colSpUtil').textContent = data.utilization?.toFixed(2);
            document.getElementById('colSpOK').textContent = data.ok ? 'OK' : 'Fail';
        });

        // SP Slab
        document.getElementById('runSlabSp').addEventListener('click', async () => {
            const payload = {
                moment_knm_per_m: parseFloat(document.getElementById('slabSpM').value),
                effective_depth_mm: parseFloat(document.getElementById('slabSpD').value),
                rb_mpa: parseFloat(document.getElementById('slabSpRb').value),
                rs_mpa: parseFloat(document.getElementById('slabSpRs').value),
                bar_diameter_mm: parseFloat(document.getElementById('slabSpBar').value),
                xi_r: parseFloat(document.getElementById('slabSpXi').value)
            };
            const res = await fetch('/api/user/tools-sp/slab/calc', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            const data = await res.json();
            document.getElementById('slabSpAs').textContent = data.as_required_mm2_per_m?.toFixed(1) + ' mm¬≤/m';
            document.getElementById('slabSpArea').textContent = data.bar_area_mm2?.toFixed(1) + ' mm¬≤';
            document.getElementById('slabSpSpacing').textContent = data.spacing_mm?.toFixed(0) + ' mm';
            document.getElementById('slabSpOK').textContent = data.ok ? 'OK' : 'Fail';
        });

        // SP Report
        document.getElementById('runReportSp').addEventListener('click', async () => {
            const payload = {
                project: document.getElementById('repProjectSp').value,
                author: document.getElementById('repAuthorSp').value,
                title: document.getElementById('repTitleSp').value,
                notes: document.getElementById('repNotesSp').value
            };
            const res = await fetch('/api/user/tools-sp/report/pdf', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!res.ok) { document.getElementById('repStatusSp').textContent = 'Error'; return; }
            const blob = await res.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'report.pdf';
            a.click();
            URL.revokeObjectURL(url);
            document.getElementById('repStatusSp').textContent = 'Downloaded';
        });

        const docsList = document.getElementById('docsList');
        const refreshDocs = document.getElementById('refreshDocs');

        async function loadDocs() {
            if (!docsList) return;
            docsList.innerHTML = '';
            try {
                const res = await fetch('/api/user/docs/list', { credentials: 'include' });
                if (!res.ok) throw new Error('list failed');
                const docs = await res.json();
                if (!docs.length) {
                    docsList.innerHTML = '<div class="doc-card"><div class="doc-name">No files in /docs</div></div>';
                    return;
                }
                docs.forEach(d => {
                    const card = document.createElement('div');
                    card.className = 'doc-card';
                    const name = document.createElement('div');
                    name.className = 'doc-name';
                    name.textContent = d.name;
                    const link = document.createElement('a');
                    link.className = 'doc-link';
                    link.href = '/docs/' + d.path;
                    link.textContent = 'Download';
                    link.setAttribute('download', '');
                    card.appendChild(name);
                    card.appendChild(link);
                    docsList.appendChild(card);
                });
            } catch (_) {
                docsList.innerHTML = '<div class="doc-card"><div class="doc-name">Failed to load docs</div></div>';
            }
        }

        if (refreshDocs) {
            refreshDocs.addEventListener('click', loadDocs);
        }

        let isPremium = false;
                const buyPremium = document.getElementById('buyPremium');

        function setPremiumUI() {
            document.querySelectorAll('.tool-card[data-premium="true"]').forEach(card => {
                if (!isPremium) {
                    card.classList.add('locked');
                } else {
                    card.classList.remove('locked');
                }
            });
            document.querySelectorAll('.tool-card .lock-badge').forEach(badge => {
                badge.style.display = isPremium ? 'none' : 'inline';
            });
            if (buyPremium) {
                buyPremium.textContent = isPremium ? 'Premium –∞–∫—Ç–∏–≤–µ–Ω' : '–ö—É–ø–∏—Ç—å Premium';
                buyPremium.disabled = isPremium;
                buyPremium.classList.toggle('active', isPremium);
            }
        }

        if (buyPremium) {
            buyPremium.addEventListener('click', async () => {
                if (isPremium) return;
                window.location.href = '/pay/';
            });
        }

    </script>
</body>
</html>
